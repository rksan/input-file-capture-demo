(self["webpackChunkinput_file_capture_demo"]=self["webpackChunkinput_file_capture_demo"]||[]).push([[85],{3278:function(t){const e={DOM:{target:".viewport"},CONSTRAINS:{audio:!1,video:{width:{min:160,ideal:2400,max:10240},height:{min:120,ideal:1440,max:4320},facingMode:"environment"}}};t.exports=(t=e.DOM.target,a=e.CONSTRAINS)=>{a.audio=!1;const n={target:t,viewport:null,video:null,canvas:null},s=t=>{let e;e=t?"string"===typeof t?document.querySelector(t):t:document.querySelector(".viewport");let a=e.querySelector(":scope>canvas");a||(a=e.createElement("canvas"),e.appendChild(a));let s=e.querySelector(":scope>video");s||(s=document.createElement("video"),e.appendChild(s)),n.viewport=e,n.canvas=a,n.video=s},i=t=>{const{viewport:e,canvas:a}=n;e.style.aspectRatio=t.aspectRatio,a.width=t.width,a.height=t.height},o={constraints:{init:Object.assign(e.CONSTRAINS,a),apply:null},stream:null,videoTrack:null},c=async t=>{try{const e=await navigator.mediaDevices.getUserMedia(t);o.stream=e;const{video:a}=n;return a.srcObject=e,e.getVideoTracks().forEach((t=>{o.videoTrack=t;const e=t.getSettings();i(e)})),e}catch(e){return Promise.reject(e)}},r=()=>(o.constraints.apply||(o.constraints.apply=Object.assign({},o.constraints.init)),o.constraints.apply),l=async t=>{const e=r();return e.video.aspectRatio={exact:t},await b(),await c(e)},u=async()=>{const{stream:t}=o;if(t){const e=t.getVideoTracks()[0],a=e.getSettings();if(a){let t=a.facingMode;"user"===t&&(t="environment");const e=r();return e.video.facingMode={ideal:t},await b(),await c(e)}}return t},d=(t,e)=>{const a=e.getContext("2d"),n={w:Math.floor(e.width),h:Math.floor(e.height)};a.clearRect(0,0,n.w,n.h),a.drawImage(t,0,0,n.w,n.h)},p={pause:!1},v=async()=>{try{let{stream:t}=o;return t||(t=await c(o.constraints.init)),t&&(p.pause=!1,t.getVideoTracks().forEach((t=>{t.enabled=!0})),requestAnimationFrame(g)),Promise.resolve(o.stream)}catch(t){return Promise.reject(t)}},m=async()=>{try{const{stream:t}=o;return t&&(p.pause=!0,t.getVideoTracks().forEach((t=>{t.enabled=!1}))),Promise.resolve(t)}catch(t){return Promise.reject(t)}},b=async()=>{try{const{stream:t}=o;return t&&(t.getTracks().forEach((t=>{t.enabled=!0,t.stop()})),o.stream=null,p.pause=!1),Promise.resolve(t)}catch(t){return Promise.reject(t)}},g=()=>{if(!p.pause){const{video:t,canvas:e}=n;d(t,e),setTimeout(requestAnimationFrame(g),1e3/30)}},h=async(t,e)=>{const{canvas:a}=n;return new Promise(((n,s)=>{try{a.toBlob((t=>{n(t)}),t,e)}catch(i){s(i)}}))},_=()=>{const{canvas:t}=n;return t.toDataURL()};return{get DOM(){return n},async init(){return new Promise((e=>(s(t),e(this))))},async start(){return await v()},async pause(){return await m()},async stop(){return await b()},async blob(){return await h()},snap(){return _()},async applyAspectRatio(t){return await l(t)},async toggleFacingMode(t){return await u(t)}}}},7935:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return B}});var n=a(3396),s=a(7139),i=a(9242);const o=t=>((0,n.dD)("data-v-4c23fb1a"),t=t(),(0,n.Cn)(),t),c={class:"wapper"},r={class:"main"},l=o((()=>(0,n._)("section",{class:"camera camera-full"},[(0,n._)("div",{class:"viewport"},[(0,n._)("canvas"),(0,n._)("video",{autoplay:"",playsinline:""})])],-1))),u={class:"position-relative",style:{width:"100%",height:"100%"}},d=o((()=>(0,n._)("div",{class:"position-absolute top-50 start-50 translate-middle"},[(0,n._)("div",{class:"spinner-border",role:"status",style:{width:"3rem",height:"3rem"}},[(0,n._)("span",{class:"visually-hidden"},"Loading...")]),(0,n._)("p",null,"カメラの権限を確認中...")],-1))),p=[d],v={class:"fixed-top m-0 p-0",style:{"background-color":"transparent"}},m={class:"nav display-1"},b={class:"nav-item"},g=o((()=>(0,n._)("i",{class:"bi bi-x-square"},null,-1))),h=[g],_={class:"nav-item dropdown"},w=o((()=>(0,n._)("button",{class:"nav-link dropdown-toggle","data-bs-toggle":"dropdown",role:"button","aria-expanded":"false"},[(0,n._)("i",{class:"bi bi-aspect-ratio"})],-1))),y={class:"dropdown-menu"},k=o((()=>(0,n._)("i",{class:"bi bi-aspect-ratio"},null,-1))),f=o((()=>(0,n._)("i",{class:"bi bi-aspect-ratio"},null,-1))),C=o((()=>(0,n._)("i",{class:"bi bi-aspect-ratio"},null,-1))),R={class:"nav-item"},A=o((()=>(0,n._)("i",{class:"bi bi-phone-flip"},null,-1))),M=[A],D=o((()=>(0,n._)("div",null,null,-1))),S=o((()=>(0,n._)("div",null,null,-1))),x={class:"fixed-bottom"},T=o((()=>(0,n._)("i",{class:"bi bi-caret-right-square"},null,-1))),q=[T],I=o((()=>(0,n._)("i",{class:"bi bi-pause-circle"},null,-1))),O=[I],P=o((()=>(0,n._)("i",{class:"bi bi-stop-fill"},null,-1))),j=[P];function F(t,e){return(0,n.wg)(),(0,n.iD)("div",c,[(0,n._)("main",r,[l,(0,n._)("section",{class:(0,s.C_)(["cover",t.ui.loaded?"":"cover-loading"])},[(0,n.wy)((0,n._)("div",u,p,512),[[i.F8,!t.ui.loaded]])],2),(0,n._)("nav",v,[(0,n._)("ul",m,[(0,n._)("li",b,[(0,n.WI)(t.$slots,"close-button",{},(()=>[(0,n._)("button",{class:"nav-link",onClick:e[0]||(e[0]=(...e)=>t.close&&t.close(...e))},h)]),!0)]),(0,n._)("li",_,[w,(0,n._)("ul",y,[(0,n._)("li",null,[(0,n._)("button",{class:"dropdown-item","data-aspect-ratio":"16/9",onClick:e[1]||(e[1]=(...e)=>t.doClickChangeAspectRatio&&t.doClickChangeAspectRatio(...e))},[k,(0,n.Uk)(" 16/9 ")])]),(0,n._)("li",null,[(0,n._)("button",{class:"dropdown-item","data-aspect-ratio":"4/3",onClick:e[2]||(e[2]=(...e)=>t.doClickChangeAspectRatio&&t.doClickChangeAspectRatio(...e))},[f,(0,n.Uk)(" 4/3 ")])]),(0,n._)("li",null,[(0,n._)("button",{class:"dropdown-item","data-aspect-ratio":"1/1",onClick:e[3]||(e[3]=(...e)=>t.doClickChangeAspectRatio&&t.doClickChangeAspectRatio(...e))},[C,(0,n.Uk)(" 1/1 ")])])])]),(0,n._)("li",R,[(0,n._)("button",{class:"nav-link",type:"button",onClick:e[4]||(e[4]=(...e)=>t.doClickFacingMode&&t.doClickFacingMode(...e))},M)])]),D,S]),(0,n._)("section",x,[(0,n.WI)(t.$slots,"start-button",{},(()=>[(0,n._)("button",{class:"btn btn-primary",onClick:e[5]||(e[5]=(...e)=>t.start&&t.start(...e))},q)]),!0),(0,n.WI)(t.$slots,"pause-button",{},(()=>[(0,n._)("button",{class:"btn btn-warning",onClick:e[6]||(e[6]=(...e)=>t.pause&&t.pause(...e))},O)]),!0),(0,n.WI)(t.$slots,"stop-button",{},(()=>[(0,n._)("button",{class:"btn btn-danger",onClick:e[7]||(e[7]=(...e)=>t.stop&&t.stop(...e))},j)]),!0)])])])}var E=a(4870),N=a(6542),U=a(3278),V=a.n(U);const W=(t,e)=>{const a=(0,N.tv)(),s=(0,E.iH)({instance:null}),i=(0,E.qj)({loaded:!1,error:""}),o=t=>{t&&t.preventDefault(),a.back()},c=t=>{t&&t.preventDefault();const a=s.value.instance;return a.start().then((t=>(i.loaded=!0,e.emit("start",{data:a}),t))).catch((t=>(console.error(t),i.error=t,t)))},r=t=>{t&&t.preventDefault();const a=s.value.instance;return a.pause().then((t=>(e.emit("pause",{data:a}),t)))},l=t=>{t&&t.preventDefault(),i.loaded=!1;const a=s.value.instance;return a.stop().then((t=>(e.emit("stop",{data:a}),t)))},u=()=>{const t=s.value.instance;return t.snap()},d=t=>{t&&t.preventDefault();const e=t.target,a=e.dataset.aspectRatio,n=s.value.instance;switch(a){case"16/9":n.applyAspectRatio(16/9);break;case"4/3":n.applyAspectRatio(4/3);break;case"1/1":n.applyAspectRatio(1);break;default:break}},p=t=>{t&&t.preventDefault();const e=s.value.instance;e.toggleFacingMode()};return(0,n.bv)((()=>{const t=V()(".viewport",{video:{width:{min:160,ideal:2400,max:10240},height:{min:120,ideal:1440,max:4320},facingMode:{ideal:"environment"},aspectRatio:{ideal:16/9}}});s.value.instance=t,t.init().then((()=>{e.emit("init",{data:t})}))})),(0,n.Ah)((()=>{l()})),{ui:i,close:o,start:c,pause:r,stop:l,snap:u,doClickChangeAspectRatio:d,doClickFacingMode:p}};var $=(0,n.aZ)({name:"p-camera",setup:W}),L=a(89);const Z=(0,L.Z)($,[["render",F],["__scopeId","data-v-4c23fb1a"]]);var B=Z}}]);
//# sourceMappingURL=camera.f7a777f1.js.map