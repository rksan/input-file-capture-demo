{"version":3,"file":"js/camera.724d933b.js","mappings":"2HAAA,MAAMA,EAAU,CACdC,IAAK,CACHC,OAAQ,aAEVC,WAAY,CACVC,MAAO,CACLC,MAAO,KACPC,OAAQ,OAKdC,EAAOC,QAAU,CACfN,EAASF,EAAQC,IAAIC,OACrBO,EAAcT,EAAQG,cAEtB,MAAMO,EAAM,CACVR,SAEAS,SAAU,KAEVP,MAAO,KAEPQ,OAAQ,MAGJC,EAAWX,IAIf,IAAIS,EAKFA,EAHGT,EAEwB,kBAAXA,EACLY,SAASC,cAAcb,GAEvBA,EAJAY,SAASC,cAAc,aAQpC,IAAIH,EAASD,EAASI,cAAc,UAC/BH,IACHA,EAASD,EAASK,cAAc,UAChCL,EAASM,YAAYL,IAIvB,IAAIR,EAAQO,EAASI,cAAc,SAC9BX,IACHA,EAAQU,SAASE,cAAc,SAC/BL,EAASM,YAAYb,IAGvBM,EAAIC,SAAWA,EACfD,EAAIE,OAASA,EACbF,EAAIN,MAAQA,CAAK,EAGbc,EAAQ,CAEZC,OAAQ,KAERC,WAAY,MAGRC,EAAaC,UACjB,MAAMH,QAAeI,UAAUC,aAAaC,aAAahB,GAEzDS,EAAMC,OAASA,EAEf,MAAM,MAAEf,EAAK,OAAEQ,GAAWF,EAa1B,OAXAN,EAAMsB,UAAYP,EAElBA,EAAOQ,iBAAiBC,SAASC,IAC/BX,EAAME,WAAaS,EAEnB,MAAMpB,EAAcoB,EAAMC,iBAE1BlB,EAAOP,MAAQI,EAAYJ,MAC3BO,EAAON,OAASG,EAAYH,MAAM,IAG7Ba,CAAM,EAGTY,EAAaA,CAAC3B,EAAOQ,KACzB,MAAMoB,EAAMpB,EAAOqB,WAAW,MACxBC,EAAO,CAAEC,EAAGC,KAAKC,MAAMzB,EAAOP,OAAQiC,EAAGF,KAAKC,MAAMzB,EAAON,SAEjE0B,EAAIO,UAAU,EAAG,EAAGL,EAAKC,EAAGD,EAAKI,GAEjCN,EAAIQ,UAAUpC,EAAO,EAAG,EAAG8B,EAAKC,EAAGD,EAAKI,EAAE,EAGtCG,EAAK,CACTC,OAAO,GAGHC,EAAQrB,UACZ,IAAI,OAAEH,GAAWD,EAcjB,OAZKC,IACHA,QAAeE,EAAWZ,IAGxBU,IACFsB,EAAGC,OAAQ,EACXvB,EAAOQ,iBAAiBC,SAASC,IAC/BA,EAAMe,SAAU,CAAI,IAERC,sBAAsBC,IAG/B5B,EAAMC,MAAM,EAGfuB,EAAQpB,UACZ,IACE,MAAM,OAAEH,GAAWD,EAQnB,OAPIC,IACFsB,EAAGC,OAAQ,EAEXvB,EAAOQ,iBAAiBC,SAASC,IAC/BA,EAAMe,SAAU,CAAK,KAGlBG,QAAQC,QAAQ7B,EACzB,CAAE,MAAO8B,GACP,OAAOF,QAAQG,OAAOD,EACxB,GAGIE,EAAO7B,UACX,IACE,MAAM,OAAEH,GAAWD,EASnB,OARIC,IACFA,EAAOiC,YAAYxB,SAASC,IAC1BA,EAAMe,SAAU,EAChBf,EAAMsB,MAAM,IAEdjC,EAAMC,OAAS,KACfsB,EAAGC,OAAQ,GAENK,QAAQC,QAAQ7B,EACzB,CAAE,MAAO8B,GACP,OAAOF,QAAQG,OAAOD,EACxB,GAGIH,EAAWA,KACf,IAAKL,EAAGC,MAAO,CACb,MAAM,MAAEtC,EAAK,OAAEQ,GAAWF,EAE1BqB,EAAW3B,EAAOQ,GAClByC,WAAyBR,sBAAsBC,GAAW,IAAO,GACnE,GAGF,MAAO,CACLxB,aACE,OAAO,IAAIyB,SAASC,IAClBnC,EAAQX,GACD8C,EAAQM,QAEnB,EAKAhC,cACE,aAAaqB,GACf,EAEArB,cACE,aAAaoB,GACf,EAKApB,aACE,aAAa6B,GACf,EACD,C,8JCzLGI,MAAM,U,UACVC,EAAAA,EAAAA,GAGU,WAHDD,MAAM,YAAU,EACvBC,EAAAA,EAAAA,GAAiB,WACjBA,EAAAA,EAAAA,GAAoC,SAA7BC,SAAA,GAASC,YAAA,O,QAGTH,MAAM,gB,kCANjBI,EAAAA,EAAAA,IAWO,OAXPC,EAWO,CAVLC,GAKAL,EAAAA,EAAAA,GAIU,UAJVM,EAIU,EAHRN,EAAAA,EAAAA,GAAqC,UAA5BO,QAAKC,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAvB,OAAAuB,EAAAvB,SAAAsB,KAAO,UACvBT,EAAAA,EAAAA,GAAqC,UAA5BO,QAAKC,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAxB,OAAAwB,EAAAxB,SAAAuB,KAAO,UACvBT,EAAAA,EAAAA,GAAmC,UAA1BO,QAAKC,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAf,MAAAe,EAAAf,QAAAc,KAAM,W,kCCA1B,MAAME,EAAQA,KACZ,MAAMC,GAAYC,EAAAA,EAAAA,IAAI,CACpBC,SAAU,OAGN3B,EAAQA,KACZ,MAAM4B,EAASH,EAAUI,MAAMF,SAE/BC,EAAO5B,OAAO,EAGVD,EAAQA,KACZ,MAAM6B,EAASH,EAAUI,MAAMF,SAE/BC,EAAO7B,OAAO,EAGVS,EAAOA,KACX,MAAMoB,EAASH,EAAUI,MAAMF,SAC/BC,EAAOpB,MAAM,EAaf,OAVAsB,EAAAA,EAAAA,KAAU,KACR,MAAMF,EAAUH,EAAUI,MAAMF,SAAWI,IAAU,YAAa,CAChEtE,MAAO,CAAEC,MAAO,KAAMC,OAAQ,OAGhCiE,EAAOI,OAAOC,MAAMC,IAClBA,EAAIlC,OAAO,GACX,IAGG,CACLA,QACAD,QACAS,OACD,EAGH,OAAe2B,EAAAA,EAAAA,IAAgB,CAC7BC,KAAM,WACNZ,U,QC3CF,MAAMa,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAEzF,O","sources":["webpack://input-file-capture-demo/./src/components/PCamera/camera.js","webpack://input-file-capture-demo/./src/components/PCamera/template.html","webpack://input-file-capture-demo/./src/components/PCamera/index.vue","webpack://input-file-capture-demo/./src/components/PCamera/index.vue?5734"],"sourcesContent":["const DEFAULT = {\n  DOM: {\n    target: \".viewport\",\n  },\n  CONSTRAINS: {\n    video: {\n      width: 1280,\n      height: 720,\n    },\n  },\n};\n\nmodule.exports = (\n  target = DEFAULT.DOM.target,\n  constraints = DEFAULT.CONSTRAINS\n) => {\n  const dom = {\n    target,\n    /** @type {HTMLElement} */\n    viewport: null,\n    /** @type {HTMLVideoElement} */\n    video: null,\n    /** @type {HTMLCanvasElement} */\n    canvas: null,\n  };\n\n  const initDom = (target) => {\n    /**\n     * @type {HTMLElement}\n     */\n    let viewport;\n\n    if (!target) {\n      viewport = document.querySelector(\".viewport\");\n    } else if (typeof target === \"string\") {\n      viewport = document.querySelector(target);\n    } else {\n      viewport = target;\n    }\n\n    // canvas\n    let canvas = viewport.querySelector(\"canvas\");\n    if (!canvas) {\n      canvas = viewport.createElement(\"canvas\");\n      viewport.appendChild(canvas);\n    }\n\n    // video\n    let video = viewport.querySelector(\"video\");\n    if (!video) {\n      video = document.createElement(\"video\");\n      viewport.appendChild(video);\n    }\n\n    dom.viewport = viewport;\n    dom.canvas = canvas;\n    dom.video = video;\n  };\n\n  const media = {\n    /** @type {MediaStream} */\n    stream: null,\n    /** @type {} */\n    videoTrack: null,\n  };\n\n  const setupMedia = async (constraints) => {\n    const stream = await navigator.mediaDevices.getUserMedia(constraints);\n\n    media.stream = stream;\n\n    const { video, canvas } = dom;\n\n    video.srcObject = stream;\n\n    stream.getVideoTracks().forEach((track) => {\n      media.videoTrack = track;\n\n      const constraints = track.getConstraints();\n\n      canvas.width = constraints.width;\n      canvas.height = constraints.height;\n    });\n\n    return stream;\n  };\n\n  const drawCanvas = (video, canvas) => {\n    const ctx = canvas.getContext(\"2d\");\n    const size = { w: Math.floor(canvas.width), h: Math.floor(canvas.height) };\n\n    ctx.clearRect(0, 0, size.w, size.h);\n\n    ctx.drawImage(video, 0, 0, size.w, size.h);\n  };\n\n  const ui = {\n    pause: false,\n  };\n\n  const start = async () => {\n    let { stream } = media;\n\n    if (!stream) {\n      stream = await setupMedia(constraints);\n    }\n\n    if (stream) {\n      ui.pause = false;\n      stream.getVideoTracks().forEach((track) => {\n        track.enabled = true;\n      });\n      /* window. */ requestAnimationFrame(progress);\n    }\n\n    return media.stream;\n  };\n\n  const pause = async () => {\n    try {\n      const { stream } = media;\n      if (stream) {\n        ui.pause = true;\n\n        stream.getVideoTracks().forEach((track) => {\n          track.enabled = false;\n        });\n      }\n      return Promise.resolve(stream);\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  };\n\n  const stop = async () => {\n    try {\n      const { stream } = media;\n      if (stream) {\n        stream.getTracks().forEach((track) => {\n          track.enabled = true;\n          track.stop();\n        });\n        media.stream = null;\n        ui.pause = false;\n      }\n      return Promise.resolve(stream);\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  };\n\n  const progress = () => {\n    if (!ui.pause) {\n      const { video, canvas } = dom;\n\n      drawCanvas(video, canvas);\n      setTimeout(/* window. */ requestAnimationFrame(progress), 1000 / 30);\n    }\n  };\n\n  return {\n    async init() {\n      return new Promise((resolve) => {\n        initDom(target);\n        return resolve(this);\n      });\n    },\n\n    /**\n     * @returns {Promise<MediaStream|DOMException>}\n     */\n    async start() {\n      return await start();\n    },\n\n    async pause() {\n      return await pause();\n    },\n\n    /**\n     * @returns {Promise<MediaStream|DOMException>}\n     */\n    async stop() {\n      return await stop();\n    },\n  };\n};\n","<main class=\"wapper\">\n  <section class=\"viewport\">\n    <canvas></canvas>\n    <video autoplay playsinline></video>\n  </section>\n\n  <section class=\"fixed-bottom\">\n    <button @click=\"start\">start</button>\n    <button @click=\"pause\">pause</button>\n    <button @click=\"stop\">stop</button>\n  </section>\n</main>\n","<template src=\"./template.html\"></template>\n\n<style scoped src=\"./style.css\"></style>\n\n<script>\nimport { defineComponent } from \"vue\";\nimport { onMounted, ref } from \"vue\";\nimport generator from \"./camera\";\n\nconst setup = () => {\n  const refCamera = ref({\n    instance: null,\n  });\n\n  const start = () => {\n    const camera = refCamera.value.instance;\n\n    camera.start();\n  };\n\n  const pause = () => {\n    const camera = refCamera.value.instance;\n\n    camera.pause();\n  };\n\n  const stop = () => {\n    const camera = refCamera.value.instance;\n    camera.stop();\n  };\n\n  onMounted(() => {\n    const camera = (refCamera.value.instance = generator(\".viewport\", {\n      video: { width: 1200, height: 720 },\n    }));\n\n    camera.init().then((ins) => {\n      ins.start();\n    });\n  });\n\n  return {\n    start,\n    pause,\n    stop,\n  };\n};\n\nexport default defineComponent({\n  name: \"p-camera\",\n  setup,\n});\n</script>\n","import { render } from \"./template.html?vue&type=template&id=2b17f998&scoped=true&external\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./style.css?vue&type=style&index=0&id=2b17f998&scoped=true&lang=css&external\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-2b17f998\"]])\n\nexport default __exports__"],"names":["DEFAULT","DOM","target","CONSTRAINS","video","width","height","module","exports","constraints","dom","viewport","canvas","initDom","document","querySelector","createElement","appendChild","media","stream","videoTrack","setupMedia","async","navigator","mediaDevices","getUserMedia","srcObject","getVideoTracks","forEach","track","getConstraints","drawCanvas","ctx","getContext","size","w","Math","floor","h","clearRect","drawImage","ui","pause","start","enabled","requestAnimationFrame","progress","Promise","resolve","err","reject","stop","getTracks","setTimeout","this","class","_createElementVNode","autoplay","playsinline","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","onClick","_cache","args","_ctx","setup","refCamera","ref","instance","camera","value","onMounted","generator","init","then","ins","defineComponent","name","__exports__","render"],"sourceRoot":""}