{"version":3,"file":"js/camera.0f765288.js","mappings":"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","sources":["webpack://input-file-capture-demo/./src/components/PCamera/camera.js","webpack://input-file-capture-demo/./src/components/PCamera/template.html","webpack://input-file-capture-demo/./src/components/PCamera/index.vue","webpack://input-file-capture-demo/./src/components/PCamera/index.vue?5734"],"sourcesContent":["const DEFAULT = {\n  DOM: {\n    target: \".viewport\",\n  },\n  CONSTRAINS: {\n    video: {\n      width: 1280,\n      height: 720,\n    },\n  },\n};\n\nmodule.exports = (\n  target = DEFAULT.DOM.target,\n  constraints = DEFAULT.CONSTRAINS\n) => {\n  const dom = {\n    target,\n    /** @type {HTMLElement} */\n    viewport: null,\n    /** @type {HTMLVideoElement} */\n    video: null,\n    /** @type {HTMLCanvasElement} */\n    canvas: null,\n  };\n\n  const initDom = (target) => {\n    /**\n     * @type {HTMLElement}\n     */\n    let viewport;\n\n    if (!target) {\n      viewport = document.querySelector(\".viewport\");\n    } else if (typeof target === \"string\") {\n      viewport = document.querySelector(target);\n    } else {\n      viewport = target;\n    }\n\n    // canvas\n    let canvas = viewport.querySelector(\"canvas\");\n    if (!canvas) {\n      canvas = viewport.createElement(\"canvas\");\n      viewport.appendChild(canvas);\n    }\n\n    // video\n    let video = viewport.querySelector(\"video\");\n    if (!video) {\n      video = document.createElement(\"video\");\n      viewport.appendChild(video);\n    }\n\n    dom.viewport = viewport;\n    dom.canvas = canvas;\n    dom.video = video;\n  };\n\n  const media = {\n    /** @type {MediaStream} */\n    stream: null,\n    /** @type {} */\n    videoTrack: null,\n  };\n\n  const setupMedia = async (constraints) => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia(constraints);\n\n      media.stream = stream;\n\n      const { video, canvas } = dom;\n\n      video.srcObject = stream;\n\n      stream.getVideoTracks().forEach((track) => {\n        media.videoTrack = track;\n\n        const settings = track.getSettings();\n\n        canvas.width = settings.width;\n        canvas.height = settings.height;\n      });\n\n      return stream;\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  };\n\n  const drawCanvas = (video, canvas) => {\n    const ctx = canvas.getContext(\"2d\");\n    const size = { w: Math.floor(canvas.width), h: Math.floor(canvas.height) };\n\n    ctx.clearRect(0, 0, size.w, size.h);\n\n    ctx.drawImage(video, 0, 0, size.w, size.h);\n  };\n\n  const ui = {\n    pause: false,\n  };\n\n  const start = async () => {\n    try {\n      let { stream } = media;\n\n      if (!stream) {\n        stream = await setupMedia(constraints);\n      }\n\n      if (stream) {\n        ui.pause = false;\n        stream.getVideoTracks().forEach((track) => {\n          track.enabled = true;\n        });\n        /* window. */ requestAnimationFrame(progress);\n      }\n\n      return Promise.resolve(media.stream);\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  };\n\n  const pause = async () => {\n    try {\n      const { stream } = media;\n      if (stream) {\n        ui.pause = true;\n\n        stream.getVideoTracks().forEach((track) => {\n          track.enabled = false;\n        });\n      }\n      return Promise.resolve(stream);\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  };\n\n  const stop = async () => {\n    try {\n      const { stream } = media;\n      if (stream) {\n        stream.getTracks().forEach((track) => {\n          track.enabled = true;\n          track.stop();\n        });\n        media.stream = null;\n        ui.pause = false;\n      }\n      return Promise.resolve(stream);\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  };\n\n  const progress = () => {\n    if (!ui.pause) {\n      const { video, canvas } = dom;\n\n      drawCanvas(video, canvas);\n      setTimeout(/* window. */ requestAnimationFrame(progress), 1000 / 30);\n    }\n  };\n\n  return {\n    get DOM() {\n      return dom;\n    },\n\n    async init() {\n      return new Promise((resolve) => {\n        initDom(target);\n        return resolve(this);\n      });\n    },\n\n    /**\n     * @returns {Promise<MediaStream|DOMException>}\n     */\n    async start() {\n      return await start();\n    },\n\n    async pause() {\n      return await pause();\n    },\n\n    /**\n     * @returns {Promise<MediaStream|DOMException>}\n     */\n    async stop() {\n      return await stop();\n    },\n  };\n};\n","<div class=\"wapper\">\n  <main class=\"main\">\n    <section class=\"camera camera-full\">\n      <div class=\"viewport\">\n        <canvas></canvas>\n        <video autoplay playsinline></video>\n      </div>\n    </section>\n\n    <section class=\"cover\" :class=\"ui.loaded ? '' : 'cover-loading'\">\n      <div\n        class=\"position-relative\"\n        style=\"width: 100%; height: 100%\"\n        v-show=\"!ui.loaded\"\n      >\n        <div class=\"position-absolute top-50 start-50 translate-middle\">\n          <div\n            class=\"spinner-border\"\n            role=\"status\"\n            style=\"width: 3rem; height: 3rem\"\n          >\n            <span class=\"visually-hidden\">Loading...</span>\n          </div>\n          <p>カメラの権限を確認中...</p>\n        </div>\n      </div>\n    </section>\n\n    <section class=\"fixed-top d-flex flex-row\">\n      <slot name=\"close-button\">\n        <button class=\"btn btn-dark\" @click=\"close\">\n          <i class=\"bi bi-x-square\"></i>\n        </button>\n      </slot>\n    </section>\n\n    <section class=\"fixed-bottom\">\n      <slot name=\"start-button\">\n        <button class=\"btn btn-primary\" @click=\"start\">\n          <i class=\"bi bi-caret-right-square\"></i>\n        </button>\n      </slot>\n      <slot name=\"pause-button\">\n        <button class=\"btn btn-warning\" @click=\"pause\">\n          <i class=\"bi bi-pause-circle\"></i>\n        </button>\n      </slot>\n      <slot name=\"stop-button\">\n        <button class=\"btn btn-danger\" @click=\"stop\">\n          <i class=\"bi bi-stop-fill\"></i>\n        </button>\n      </slot>\n    </section>\n  </main>\n</div>\n","<template src=\"./template.html\"></template>\n\n<style scoped src=\"./style.css\"></style>\n\n<script>\nimport { defineComponent } from \"vue\";\nimport { onMounted, onUnmounted, ref, reactive } from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport generator from \"./camera\";\n\nconst setup = (props, context) => {\n  const $router = useRouter();\n\n  const refCamera = ref({\n    instance: null,\n  });\n\n  const ui = reactive({\n    loaded: false,\n    error: \"\",\n  });\n\n  const close = (event) => {\n    if (event) event.preventDefault();\n\n    $router.back();\n  };\n\n  const start = (event) => {\n    if (event) event.preventDefault();\n\n    const camera = refCamera.value.instance;\n\n    return camera\n      .start()\n      .then((stream) => {\n        console.log(\"start\");\n        ui.loaded = true;\n        context.emit(\"start\", { data: camera });\n        return stream;\n      })\n      .catch((err) => {\n        console.error(err);\n        ui.error = err;\n        return err;\n      });\n  };\n\n  const pause = (event) => {\n    if (event) event.preventDefault();\n    const camera = refCamera.value.instance;\n    return camera.pause().then((stream) => {\n      context.emit(\"pause\", { data: camera });\n      return stream;\n    });\n  };\n\n  const stop = (event) => {\n    if (event) event.preventDefault();\n\n    ui.loaded = false;\n\n    const camera = refCamera.value.instance;\n\n    return camera.stop().then((stream) => {\n      context.emit(\"stop\", { data: camera });\n      return stream;\n    });\n  };\n\n  onMounted(() => {\n    const camera = (refCamera.value.instance = generator(\".viewport\", {\n      video: {\n        width: { min: 160, ideal: 1200, max: 10240 },\n        height: { min: 120, ideal: 720, max: 4320 },\n        facingMode: \"environment\",\n      },\n    }));\n\n    camera.init().then(() => {\n      context.emit(\"init\", { data: camera });\n    });\n  });\n\n  onUnmounted(() => {\n    stop();\n  });\n\n  return {\n    ui,\n    close,\n    start,\n    pause,\n    stop,\n  };\n};\n\nexport default defineComponent({\n  name: \"p-camera\",\n  setup,\n});\n</script>\n","import { render } from \"./template.html?vue&type=template&id=3ae02e9c&scoped=true&external\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./style.css?vue&type=style&index=0&id=3ae02e9c&scoped=true&lang=css&external\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-3ae02e9c\"]])\n\nexport default __exports__"],"names":["DEFAULT","DOM","target","CONSTRAINS","video","width","height","module","exports","constraints","dom","viewport","canvas","initDom","document","querySelector","createElement","appendChild","media","stream","videoTrack","setupMedia","async","navigator","mediaDevices","getUserMedia","srcObject","getVideoTracks","forEach","track","settings","getSettings","err","Promise","reject","drawCanvas","ctx","getContext","size","w","Math","floor","h","clearRect","drawImage","ui","pause","start","enabled","requestAnimationFrame","progress","resolve","stop","getTracks","setTimeout","this","class","_createElementVNode","autoplay","playsinline","style","role","_hoisted_5","_hoisted_8","_hoisted_11","_hoisted_13","_hoisted_15","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","_normalizeClass","_ctx","loaded","_hoisted_4","_hoisted_6","_hoisted_7","_renderSlot","$slots","onClick","_cache","args","close","_hoisted_9","_hoisted_10","_hoisted_12","_hoisted_14","_hoisted_16","setup","props","context","$router","useRouter","refCamera","ref","instance","reactive","error","event","preventDefault","back","camera","value","then","console","log","emit","data","catch","onMounted","generator","min","ideal","max","facingMode","init","onUnmounted","defineComponent","name","__exports__","render"],"sourceRoot":""}