(self["webpackChunkinput_file_capture_demo"]=self["webpackChunkinput_file_capture_demo"]||[]).push([[85],{3278:function(e){const t={DOM:{target:".viewport"},CONSTRAINS:{video:{width:{min:160,ideal:1200,max:10240},height:{min:120,ideal:720,max:4320},facingMode:"environment"}}};e.exports=(e=t.DOM.target,a=t.CONSTRAINS)=>{const n={target:e,viewport:null,video:null,canvas:null},s=e=>{let t;t=e?"string"===typeof e?document.querySelector(e):e:document.querySelector(".viewport");let a=t.querySelector(":scope>canvas");a||(a=t.createElement("canvas"),t.appendChild(a));let s=t.querySelector(":scope>video");s||(s=document.createElement("video"),t.appendChild(s)),n.viewport=t,n.canvas=a,n.video=s},r={stream:null,videoTrack:null},o=async e=>{try{const t=await navigator.mediaDevices.getUserMedia(e);r.stream=t;const{video:a,canvas:s}=n;return a.srcObject=t,t.getVideoTracks().forEach((e=>{r.videoTrack=e;const t=e.getSettings();s.width=t.width,s.height=t.height})),t}catch(t){return Promise.reject(t)}},i=(e,t)=>{const a=t.getContext("2d"),n={w:Math.floor(t.width),h:Math.floor(t.height)};a.clearRect(0,0,n.w,n.h),a.drawImage(e,0,0,n.w,n.h)},c={pause:!1},l=async()=>{try{let{stream:e}=r;return e||(e=await o(a)),e&&(c.pause=!1,e.getVideoTracks().forEach((e=>{e.enabled=!0})),requestAnimationFrame(p)),Promise.resolve(r.stream)}catch(e){return Promise.reject(e)}},u=async()=>{try{const{stream:e}=r;return e&&(c.pause=!0,e.getVideoTracks().forEach((e=>{e.enabled=!1}))),Promise.resolve(e)}catch(e){return Promise.reject(e)}},d=async()=>{try{const{stream:e}=r;return e&&(e.getTracks().forEach((e=>{e.enabled=!0,e.stop()})),r.stream=null,c.pause=!1),Promise.resolve(e)}catch(e){return Promise.reject(e)}},p=()=>{if(!c.pause){const{video:e,canvas:t}=n;i(e,t),setTimeout(requestAnimationFrame(p),1e3/30)}},v=async(e,t)=>{const{canvas:a}=n;return new Promise(((n,s)=>{try{a.toBlob((e=>{n(e)}),e,t)}catch(r){s(r)}}))},m=()=>{const{canvas:e}=n;return e.toDataURL()};return{get DOM(){return n},async init(){return new Promise((t=>(s(e),t(this))))},async start(){return await l()},async pause(){return await u()},async stop(){return await d()},async blob(){return await v()},snap(){return m()}}}},1281:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var n=a(3396),s=a(7139),r=a(9242);const o=e=>((0,n.dD)("data-v-85020d08"),e=e(),(0,n.Cn)(),e),i={class:"wapper"},c={class:"main"},l=o((()=>(0,n._)("section",{class:"camera camera-full"},[(0,n._)("div",{class:"viewport"},[(0,n._)("canvas"),(0,n._)("video",{autoplay:"",playsinline:""})])],-1))),u={class:"position-relative",style:{width:"100%",height:"100%"}},d=o((()=>(0,n._)("div",{class:"position-absolute top-50 start-50 translate-middle"},[(0,n._)("div",{class:"spinner-border",role:"status",style:{width:"3rem",height:"3rem"}},[(0,n._)("span",{class:"visually-hidden"},"Loading...")]),(0,n._)("p",null,"カメラの権限を確認中...")],-1))),p=[d],v={class:"fixed-top d-flex flex-row"},m=o((()=>(0,n._)("i",{class:"bi bi-x-square"},null,-1))),h=[m],b={class:"fixed-bottom"},w=o((()=>(0,n._)("i",{class:"bi bi-caret-right-square"},null,-1))),g=[w],_=o((()=>(0,n._)("i",{class:"bi bi-pause-circle"},null,-1))),f=[_],y=o((()=>(0,n._)("i",{class:"bi bi-stop-fill"},null,-1))),k=[y];function C(e,t){return(0,n.wg)(),(0,n.iD)("div",i,[(0,n._)("main",c,[l,(0,n._)("section",{class:(0,s.C_)(["cover",e.ui.loaded?"":"cover-loading"])},[(0,n.wy)((0,n._)("div",u,p,512),[[r.F8,!e.ui.loaded]])],2),(0,n._)("section",v,[(0,n.WI)(e.$slots,"close-button",{},(()=>[(0,n._)("button",{class:"btn btn-dark",onClick:t[0]||(t[0]=(...t)=>e.close&&e.close(...t))},h)]),!0)]),(0,n._)("section",b,[(0,n.WI)(e.$slots,"start-button",{},(()=>[(0,n._)("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...t)=>e.start&&e.start(...t))},g)]),!0),(0,n.WI)(e.$slots,"pause-button",{},(()=>[(0,n._)("button",{class:"btn btn-warning",onClick:t[2]||(t[2]=(...t)=>e.pause&&e.pause(...t))},f)]),!0),(0,n.WI)(e.$slots,"stop-button",{},(()=>[(0,n._)("button",{class:"btn btn-danger",onClick:t[3]||(t[3]=(...t)=>e.stop&&e.stop(...t))},k)]),!0)])])])}var x=a(4870),D=a(6542),q=a(3278),P=a.n(q);const S=(e,t)=>{const a=(0,D.tv)(),s=(0,x.iH)({instance:null}),r=(0,x.qj)({loaded:!1,error:""}),o=e=>{e&&e.preventDefault(),a.back()},i=e=>{e&&e.preventDefault();const a=s.value.instance;return a.start().then((e=>(console.log("start"),r.loaded=!0,t.emit("start",{data:a}),e))).catch((e=>(console.error(e),r.error=e,e)))},c=e=>{e&&e.preventDefault();const a=s.value.instance;return a.pause().then((e=>(t.emit("pause",{data:a}),e)))},l=e=>{e&&e.preventDefault(),r.loaded=!1;const a=s.value.instance;return a.stop().then((e=>(t.emit("stop",{data:a}),e)))},u=()=>{const e=s.value.instance;return e.snap()};return(0,n.bv)((()=>{const e=s.value.instance=P()(".viewport",{video:{width:{min:160,ideal:1200,max:10240},height:{min:120,ideal:720,max:4320},facingMode:"environment"}});e.init().then((()=>{t.emit("init",{data:e})}))})),(0,n.Ah)((()=>{l()})),{ui:r,close:o,start:i,pause:c,stop:l,snap:u}};var T=(0,n.aZ)({name:"p-camera",setup:S}),I=a(89);const M=(0,I.Z)(T,[["render",C],["__scopeId","data-v-85020d08"]]);var j=M}}]);
//# sourceMappingURL=camera.3d2cc1bb.js.map